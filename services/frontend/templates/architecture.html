{% extends "base.html" %}

{% block title %}Architecture - Student Grading System{% endblock %}

{% block extra_css %}
<style>
    .arch-diagram {
        background: var(--bg-tertiary);
        border-radius: var(--radius-lg);
        padding: 2rem;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.85rem;
        overflow-x: auto;
        white-space: pre;
        line-height: 1.4;
    }
    
    .concept-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        margin-bottom: 1rem;
    }
    
    .concept-card h3 {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }
    
    .concept-icon {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
    }
    
    .command-block {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        padding: 1rem;
        margin: 1rem 0;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.85rem;
        overflow-x: auto;
    }
    
    .command-block code {
        background: none;
        padding: 0;
    }
    
    .traffic-flow {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        background: var(--bg-tertiary);
        border-radius: var(--radius-sm);
        margin: 0.5rem 0;
    }
    
    .traffic-arrow {
        color: var(--accent-cyan);
        font-weight: bold;
    }
    
    .allowed { color: var(--accent-teal); }
    .blocked { color: var(--accent-red); }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>System Architecture</h1>
    <p>Understanding the microservices architecture with Kubernetes Ingress & Egress</p>
</div>

<!-- Architecture Diagram -->
<div class="card">
    <div class="card-header">
        <div class="card-title">
            <span class="card-icon">ğŸ—ï¸</span>
            Microservices Architecture
        </div>
    </div>
    
    <div class="arch-diagram">
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚         INTERNET            â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              KUBERNETES CLUSTER                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         INGRESS CONTROLLER (nginx)                              â”‚  â”‚
â”‚  â”‚                                                                                 â”‚  â”‚
â”‚  â”‚    Routes:  /           â†’ frontend:5000                                         â”‚  â”‚
â”‚  â”‚             /api/students â†’ student-service:5001                                â”‚  â”‚
â”‚  â”‚             /api/grades   â†’ grade-service:5002                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚                                 â–¼                                  â”‚            â”‚
â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚            â”‚
â”‚    â”‚    â”‚   FRONTEND   â”‚â”€â”€â”€â–¶â”‚ STUDENT-SERVICE  â”‚â—€â”€â”€â”€â”‚ GRADE-SERVICEâ”‚   â”‚            â”‚
â”‚    â”‚    â”‚   :5000      â”‚    â”‚     :5001        â”‚    â”‚    :5002     â”‚   â”‚            â”‚
â”‚    â”‚    â”‚              â”‚â”€â”€â”€â–¶â”‚                  â”‚    â”‚              â”‚   â”‚            â”‚
â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚            â”‚
â”‚    â”‚           â”‚                                           â”‚            â”‚            â”‚
â”‚    â”‚           â”‚              NetworkPolicies              â”‚            â”‚            â”‚
â”‚    â”‚           â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚            â”‚            â”‚
â”‚    â”‚           â”‚    â”‚ âœ… Frontend â†’ Student Service  â”‚    â”‚            â”‚            â”‚
â”‚    â”‚           â”‚    â”‚ âœ… Frontend â†’ Grade Service    â”‚    â”‚            â”‚            â”‚
â”‚    â”‚           â”‚    â”‚ âœ… Grade Service â†’ Student Svc â”‚    â”‚            â”‚            â”‚
â”‚    â”‚           â”‚    â”‚ âŒ Any Pod â†’ External Internet â”‚    â”‚            â”‚            â”‚
â”‚    â”‚           â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚            â”‚            â”‚
â”‚    â”‚                                                                    â”‚            â”‚
â”‚    â”‚                      grading-system namespace                      â”‚            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    </div>
</div>

<div class="grid grid-2">
    <!-- Ingress Explanation -->
    <div class="concept-card">
        <h3>
            <span class="concept-icon" style="background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));">ğŸ“¥</span>
            Ingress (Traffic IN)
        </h3>
        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            <strong>Ingress</strong> manages external access to services in a cluster, typically HTTP/HTTPS traffic.
            It provides load balancing, SSL termination, and name-based virtual hosting.
        </p>
        
        <h4 style="margin: 1rem 0 0.5rem; color: var(--accent-cyan);">How it works here:</h4>
        <div class="traffic-flow">
            <span>Browser</span>
            <span class="traffic-arrow">â†’</span>
            <span>Ingress Controller</span>
            <span class="traffic-arrow">â†’</span>
            <span>Service</span>
        </div>
        
        <h4 style="margin: 1rem 0 0.5rem; color: var(--accent-cyan);">Routing Rules:</h4>
        <ul style="color: var(--text-secondary); margin-left: 1.5rem;">
            <li><code>/</code> â†’ Frontend Service (port 5000)</li>
            <li><code>/api/students/*</code> â†’ Student Service (port 5001)</li>
            <li><code>/api/grades/*</code> â†’ Grade Service (port 5002)</li>
        </ul>
        
        <div class="command-block">
<code># View ingress rules
kubectl get ingress -n grading-system
kubectl describe ingress -n grading-system</code>
        </div>
    </div>

    <!-- Egress Explanation -->
    <div class="concept-card">
        <h3>
            <span class="concept-icon" style="background: linear-gradient(135deg, var(--accent-teal), var(--accent-cyan));">ğŸ“¤</span>
            Egress (Traffic OUT)
        </h3>
        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
            <strong>Egress</strong> refers to outbound traffic from pods. <strong>NetworkPolicies</strong> control 
            which pods can communicate with each other and with external services.
        </p>
        
        <h4 style="margin: 1rem 0 0.5rem; color: var(--accent-teal);">What's allowed:</h4>
        <div class="traffic-flow">
            <span>Grade Service</span>
            <span class="traffic-arrow">â†’</span>
            <span class="allowed">Student Service âœ…</span>
        </div>
        
        <h4 style="margin: 1rem 0 0.5rem; color: var(--accent-red);">What's blocked:</h4>
        <div class="traffic-flow">
            <span>Any Pod</span>
            <span class="traffic-arrow">â†’</span>
            <span class="blocked">External Internet âŒ</span>
        </div>
        
        <div class="command-block">
<code># View network policies
kubectl get networkpolicies -n grading-system

# Test blocked egress (from inside a pod)
kubectl exec -it deploy/grade-service \
  -n grading-system -- curl -s --max-time 5 https://httpbin.org/get
# Should timeout/fail!</code>
        </div>
    </div>
</div>

<!-- Services Detail -->
<div class="card">
    <div class="card-header">
        <div class="card-title">
            <span class="card-icon">ğŸ”§</span>
            Microservices Overview
        </div>
    </div>
    
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Service</th>
                    <th>Port</th>
                    <th>Purpose</th>
                    <th>Egress Permissions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Frontend</strong></td>
                    <td>5000</td>
                    <td>Web UI, proxies API requests to backend services</td>
                    <td class="allowed">â†’ student-service, grade-service</td>
                </tr>
                <tr>
                    <td><strong>Student Service</strong></td>
                    <td>5001</td>
                    <td>CRUD API for student records</td>
                    <td class="blocked">â†’ None (only accepts incoming)</td>
                </tr>
                <tr>
                    <td><strong>Grade Service</strong></td>
                    <td>5002</td>
                    <td>CRUD API for grades, enriches with student names</td>
                    <td class="allowed">â†’ student-service</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Useful Commands -->
<div class="card">
    <div class="card-header">
        <div class="card-title">
            <span class="card-icon">ğŸ’»</span>
            Useful kubectl Commands
        </div>
    </div>
    
    <div class="grid grid-2">
        <div>
            <h4 style="margin-bottom: 0.75rem; color: var(--accent-cyan);">View Resources</h4>
            <div class="command-block">
<code># All resources in namespace
kubectl get all -n grading-system

# View pods
kubectl get pods -n grading-system

# View services
kubectl get svc -n grading-system

# View ingress
kubectl get ingress -n grading-system</code>
            </div>
        </div>
        
        <div>
            <h4 style="margin-bottom: 0.75rem; color: var(--accent-teal);">Debug & Test</h4>
            <div class="command-block">
<code># View pod logs
kubectl logs -f deploy/frontend -n grading-system

# Exec into a pod
kubectl exec -it deploy/grade-service \
  -n grading-system -- /bin/sh

# Test service-to-service call
kubectl exec -it deploy/grade-service \
  -n grading-system -- \
  curl http://student-service:5001/health</code>
            </div>
        </div>
    </div>
</div>
{% endblock %}

